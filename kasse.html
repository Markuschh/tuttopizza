<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kasse / Bestelleingang – Tutto Pizza</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="theme-dark">
  <header class="header">
    <div class="container row between">
      <a class="brand" href="./">
        <img class="brand-mark" src="assets/6EAF66E0-83DC-41A1-A030-A88D31B30F39.jpeg" alt="Tutto Pizza Logo"/>
        <span class="brand-name">Tutto <strong>Pizza</strong></span>
      </a>
      <nav class="nav" aria-label="Hauptnavigation">
        <a href="./speisekarte.html">Speisekarte</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Kasse / Bestelleingang</h1>
    <p class="muted">Diese Ansicht zeigt Bestellungen, die vom Online-Formular lokal gespeichert wurden. Für Mehrgerätebetrieb bitte Backend anbinden.</p>
    <div class="kasse-controls">
      <button class="btn" id="refresh">Aktualisieren</button>
      <button class="btn ghost" id="export">Export (JSON)</button>
      <button class="btn danger" id="clear">Alles löschen</button>
    </div>
    <div id="orders" class="orders"></div>
  </main>

  <footer class="footer">
    <div class="container row between wrap">
      <p>© <span id="year"></span> Tutto Pizza</p>
    </div>
  </footer>

  <script src="site.js"></script>
  <script>
    function load(){
      const root = document.getElementById('orders'); root.innerHTML='';
      const all = JSON.parse(localStorage.getItem('tutto_orders')||'[]').sort((a,b)=>b.ts-a.ts);
      if(!all.length){ root.innerHTML='<p class="muted">Noch keine Bestellungen.</p>'; return; }
      all.forEach((o, idx)=>{
        const div = document.createElement('div'); div.className='order-card';
        const items = o.items.map(i=>`${i.qty}× ${i.name}`).join(', ');
        div.innerHTML = `
          <header><strong>#${o.id}</strong> <span class="muted">• ${new Date(o.ts).toLocaleString()}</span></header>
          <p><strong>${o.mode.toUpperCase()}</strong> – Zahlung: ${o.pay}</p>
          <p>Warenkorb: ${items}</p>
          <p>Summe: <strong>${o.total.toFixed(2).replace('.',',')} €</strong></p>
          <p>Telefon: <a href="tel:${o.phone}">${o.phone}</a></p>
          ${o.mode==='lieferung' ? `<p>Adresse: ${o.street}, ${o.city} (${o.note||''})</p>` : '<p>Abholung im Laden</p>'}
          ${o.notes?`<p>Notiz: ${o.notes}</p>`:''}
        `;
        root.appendChild(div);
      });
    }
    document.getElementById('refresh').onclick=load;
    document.getElementById('clear').onclick=()=>{ if(confirm('Alle Bestellungen löschen?')){ localStorage.removeItem('tutto_orders'); load(); } };
    document.getElementById('export').onclick=()=>{
      const data = localStorage.getItem('tutto_orders')||'[]';
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), {href:url, download:'tutto-orders.json'});
      a.click(); URL.revokeObjectURL(url);
    };
    load();
  </script>
</body>
</html>
